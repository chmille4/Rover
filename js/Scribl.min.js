var BAM_MAGIC=21840194,BAI_MAGIC=21578050;function BamFile(){}function Vob(a,b){this.block=a;this.offset=b}Vob.prototype.toString=function(){return""+this.block+":"+this.offset};function Chunk(a,b){this.minv=a;this.maxv=b}
function makeBam(a,b,c){var d=new BamFile;d.data=a;d.bai=b;d.data.fetch(function(a){if(!a)return alert("Couldn't access BAM");a=unbgzf(a);a=new Uint8Array(a);readInt(a,0);for(var b=readInt(a,4),i="",j=0;j<b;++j)i+=String.fromCharCode(a[j+8]);i=readInt(a,b+8);b+=12;d.chrToIndex={};d.indexToChr=[];for(j=0;j<i;++j){for(var k=readInt(a,b),l="",n=0;n<k-1;++n)l+=String.fromCharCode(a[b+4+n]);readInt(a,b+k+4);d.chrToIndex[l]=j;l.indexOf("chr")==0?d.chrToIndex[l.substring(3)]=j:d.chrToIndex["chr"+l]=j;d.indexToChr.push(l);
b=b+8+k}if(d.indices)return c(d)});d.bai.fetch(function(a){if(!a)return alert("Couldn't access BAI");var b=new Uint8Array(a);if(readInt(b,0)!=BAI_MAGIC)return alert("Not a BAI file");var i=readInt(b,4);d.indices=[];for(var j=8,k=0;k<i;++k){var l=j,n=readInt(b,j);j+=4;for(var o=0;o<n;++o){readInt(b,j);var m=readInt(b,j+4);j+=8+m*16}o=readInt(b,j);j+=4;j+=o*8;n>0&&(d.indices[k]=new Uint8Array(a,l,j-l))}if(d.chrToIndex)return c(d)})}
BamFile.prototype.blocksForRange=function(a,b,c){var d=this.indices[a];if(!d)return[];a=reg2bins(b,c);for(var e=[],g=0;g<a.length;++g)e[a[g]]=!0;a=[];var i=[];g=readInt(d,0);for(var j=4,k=0;k<g;++k){var l=readInt(d,j),n=readInt(d,j+4);j+=8;if(e[l])for(var o=0;o<n;++o){var m=readVob(d,j),p=readVob(d,j+8);(l<4681?i:a).push(new Chunk(m,p));j+=16}else j+=n*16}g=readInt(d,j);e=null;c=Math.min(c>>14,g-1);for(g=Math.min(b>>14,g-1);g<=c;++g)if((b=readVob(d,j+4+g*8))&&(!e||b.block<e.block||b.offset<e.offset))e=
b;b=[];if(e!=null)for(g=0;g<i.length;++g)d=i[g],d.maxv.block>=e.block&&d.maxv.offset>=e.offset&&b.push(d);i=b;b=[];for(g=0;g<i.length;++g)b.push(i[g]);for(g=0;g<a.length;++g)b.push(a[g]);b.sort(function(a,b){var c=a.minv.block-b.minv.block;return c!=0?c:a.minv.offset-b.minv.offset});a=[];if(b.length>0){i=b[0];for(g=1;g<b.length;++g)d=b[g],d.minv.block==i.maxv.block?i=new Chunk(i.minv,d.maxv):(a.push(i),i=d);a.push(i)}return a};
BamFile.prototype.fetch=function(a,b,c,d){function e(){if(l>=j.length)return d(k);else if(n){var a=new Uint8Array(n);g.readBamRecords(a,j[l].minv.offset,k,b,c,i);n=null;++l;return e()}else{var m=j[l];a=m.minv.block;g.data.slice(a,m.maxv.block+65536-a).fetch(function(a){n=unbgzf(a,m.maxv.block-m.minv.block+1);return e()})}}var g=this,i=this.chrToIndex[a],j;i===void 0?j=[]:(j=this.blocksForRange(i,b,c))||d(null,"Error in index fetch");var k=[],l=0,n;e()};
var SEQRET_DECODER=["=","A","C","x","G","x","x","x","T","x","x","x","x","x","x","N"],CIGAR_DECODER=["M","I","D","N","S","H","P","=","X","?","?","?","?","?","?","?"];function BamRecord(){}
BamFile.prototype.readBamRecords=function(a,b,c,d,e,g){for(;;){var i=readInt(a,b);i=b+i+4;if(i>=a.length)return c;var j=new BamRecord,k=readInt(a,b+4),l=readInt(a,b+8),n=readInt(a,b+12),o=(n&65280)>>8,m=n&255,p=readInt(a,b+16)&65535;n=readInt(a,b+20);readInt(a,b+24);readInt(a,b+28);readInt(a,b+32);for(var s="",q=0;q<m-1;++q)s+=String.fromCharCode(a[b+36+q]);b=b+36+m;q=0;m="";for(var v=0;v<p;++v){var w=readInt(a,b),r=w>>4;w=CIGAR_DECODER[w&15];if(w=="M"||w=="I"||w=="X")q+=r;m=m+r+w;b+=4}j.cigar=m;
j.lengthOnRef=q;p="";m=n+1>>1;for(q=0;q<m;++q)v=a[b+q],p+=SEQRET_DECODER[(v&240)>>4],p+=SEQRET_DECODER[v&15];b+=m;j.seq=p;p="";for(q=0;q<n;++q)p+=String.fromCharCode(a[b+q]);b+=n;j.quals=p;j.pos=l;j.mq=o;j.readName=s;for(j.segment=this.indexToChr[k];b<i;){l=String.fromCharCode(a[b])+String.fromCharCode(a[b+1]);o=String.fromCharCode(a[b+2]);if(o=="A")o=String.fromCharCode(a[b+3]),b+=4;else if(o=="i"||o=="I")o=readInt(a,b+3),b+=7;else if(o=="c"||o=="C")o=a[b+3],b+=4;else if(o=="s"||o=="S")o=readShort(a,
b+3),b+=5;else if(o=="f")throw"FIXME need floats";else if(o=="Z"){b+=3;for(o="";;)if(s=a[b++],s==0)break;else o+=String.fromCharCode(s)}else throw"Unknown type "+o;j[l]=o}if(!d||j.pos<=e&&j.pos+n>=d)(g===void 0||k==g)&&c.push(j);b=i}};function readInt(a,b){return a[b+3]<<24|a[b+2]<<16|a[b+1]<<8|a[b]}function readShort(a,b){return a[b+1]<<8|a[b]}
function readVob(a,b){var c=(a[b+6]&255)*4294967296+(a[b+5]&255)*16777216+(a[b+4]&255)*65536+(a[b+3]&255)*256+(a[b+2]&255),d=a[b+1]<<8|a[b];return c==0&&d==0?null:new Vob(c,d)}
function unbgzf(a,b){b=Math.min(b||1,a.byteLength-100);for(var c=[],d=[0],e=0;d[0]<b;){var g=new Uint8Array(a,d[0],100);g=g[11]<<8|g[10];g=jszlib_inflate_buffer(a,12+g+d[0],Math.min(65536,a.byteLength-12-g-d[0]),d);d[0]+=8;e+=g.byteLength;c.push(g)}if(c.length==1)return c[0];else{d=new Uint8Array(e);for(g=e=0;g<c.length;++g){var i=new Uint8Array(c[g]);arrayCopy(i,0,d,e,i.length);e+=i.length}return d.buffer}}
function reg2bin(a,b){--b;if(a>>14==b>>14)return 4681+(a>>14);if(a>>17==b>>17)return 585+(a>>17);if(a>>20==b>>20)return 73+(a>>20);if(a>>23==b>>23)return 9+(a>>23);if(a>>26==b>>26)return 1+(a>>26);return 0}var MAX_BIN=37449;
function reg2bins(a,b){var c,d=[];--b;d.push(0);for(c=1+(a>>26);c<=1+(b>>26);++c)d.push(c);for(c=9+(a>>23);c<=9+(b>>23);++c)d.push(c);for(c=73+(a>>20);c<=73+(b>>20);++c)d.push(c);for(c=585+(a>>17);c<=585+(b>>17);++c)d.push(c);for(c=4681+(a>>14);c<=4681+(b>>14);++c)d.push(c);return d};function BlobFetchable(a){this.blob=a}BlobFetchable.prototype.slice=function(a,b){var c;b?this.blob.webkitSlice?c=this.blob.webkitSlice(a,a+b):this.blob.mozSlice&&(c=this.blob.mozSlice(a,a+b)):this.blob.webkitSlice?c=this.blob.webkitSlice(a):this.blob.mozSlice&&(c=this.blob.mozSlice(a));return new BlobFetchable(c)};BlobFetchable.prototype.fetch=function(a){var b=new FileReader;b.onloadend=function(){a(bstringToBuffer(b.result))};b.readAsBinaryString(this.blob)};
function URLFetchable(a,b,c,d){d||(typeof b==="object"?(d=b,b=void 0):d={});this.url=a;this.start=b||0;if(c)this.end=c;this.opts=d}URLFetchable.prototype.slice=function(a,b){var c=this.start,d=this.end;c&&a?c+=a:c=a||c;return new URLFetchable(this.url,c,b&&c?c+b-1:d||b-1,this.opts)};
URLFetchable.prototype.fetch=function(a,b,c){var d=this;b=b||1;if(b>3)return a(null);var e=new XMLHttpRequest,g;e.open("GET",this.url,!0);e.overrideMimeType("text/plain; charset=x-user-defined");this.end&&(e.setRequestHeader("Range","bytes="+this.start+"-"+this.end),g=this.end-this.start+1);e.responseType="arraybuffer";e.onreadystatechange=function(){if(e.readyState==4)if(e.status==200||e.status==206)if(e.response)return a(e.response);else if(e.mozResponseArrayBuffer)return a(e.mozResponseArrayBuffer);
else{var i=e.responseText;return g&&g!=i.length&&(!c||i.length!=c)?d.fetch(a,b+1,i.length):(alert(e.responseText),a(bstringToBuffer(e.responseText)))}else return d.fetch(a,b+1)};if(this.opts.credentials)e.withCredentials=!0;e.send("")};function bstringToBuffer(a){if(!a)return null;for(var b=new Uint8Array(a.length),c=0;c<b.length;++c)b[c]=a.charCodeAt(c);return b.buffer};var MAX_WBITS=15,DEF_WBITS=MAX_WBITS,MAX_MEM_LEVEL=9,MANY=1440,BMAX=15,PRESET_DICT=32,Z_NO_FLUSH=0,Z_PARTIAL_FLUSH=1,Z_SYNC_FLUSH=2,Z_FULL_FLUSH=3,Z_FINISH=4,Z_DEFLATED=8,Z_OK=0,Z_STREAM_END=1,Z_NEED_DICT=2,Z_ERRNO=-1,Z_STREAM_ERROR=-2,Z_DATA_ERROR=-3,Z_MEM_ERROR=-4,Z_BUF_ERROR=-5,Z_VERSION_ERROR=-6,METHOD=0,FLAG=1,DICT4=2,DICT3=3,DICT2=4,DICT1=5,DICT0=6,BLOCKS=7,CHECK4=8,CHECK3=9,CHECK2=10,CHECK1=11,DONE=12,BAD=13,inflate_mask=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535],
IB_TYPE=0,IB_LENS=1,IB_STORED=2,IB_TABLE=3,IB_BTREE=4,IB_DTREE=5,IB_CODES=6,IB_DRY=7,IB_DONE=8,IB_BAD=9,fixed_bl=9,fixed_bd=5,fixed_tl=[96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,192,80,7,10,0,8,96,0,8,32,0,9,160,0,8,0,0,8,128,0,8,64,0,9,224,80,7,6,0,8,88,0,8,24,0,9,144,83,7,59,0,8,120,0,8,56,0,9,208,81,7,17,0,8,104,0,8,40,0,9,176,0,8,8,0,8,136,0,8,72,0,9,240,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,200,81,7,13,0,8,100,0,8,36,0,9,168,0,8,4,0,8,132,0,8,68,0,9,232,80,
7,8,0,8,92,0,8,28,0,9,152,84,7,83,0,8,124,0,8,60,0,9,216,82,7,23,0,8,108,0,8,44,0,9,184,0,8,12,0,8,140,0,8,76,0,9,248,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,196,81,7,11,0,8,98,0,8,34,0,9,164,0,8,2,0,8,130,0,8,66,0,9,228,80,7,7,0,8,90,0,8,26,0,9,148,84,7,67,0,8,122,0,8,58,0,9,212,82,7,19,0,8,106,0,8,42,0,9,180,0,8,10,0,8,138,0,8,74,0,9,244,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,204,81,7,15,0,8,102,0,8,38,0,9,172,0,8,6,0,8,134,0,8,70,0,9,236,80,7,9,0,8,94,0,8,30,0,
9,156,84,7,99,0,8,126,0,8,62,0,9,220,82,7,27,0,8,110,0,8,46,0,9,188,0,8,14,0,8,142,0,8,78,0,9,252,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,194,80,7,10,0,8,97,0,8,33,0,9,162,0,8,1,0,8,129,0,8,65,0,9,226,80,7,6,0,8,89,0,8,25,0,9,146,83,7,59,0,8,121,0,8,57,0,9,210,81,7,17,0,8,105,0,8,41,0,9,178,0,8,9,0,8,137,0,8,73,0,9,242,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,202,81,7,13,0,8,101,0,8,37,0,9,170,0,8,5,0,8,133,0,8,69,0,9,234,80,7,8,0,8,93,0,8,29,0,9,154,84,7,83,0,8,
125,0,8,61,0,9,218,82,7,23,0,8,109,0,8,45,0,9,186,0,8,13,0,8,141,0,8,77,0,9,250,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,198,81,7,11,0,8,99,0,8,35,0,9,166,0,8,3,0,8,131,0,8,67,0,9,230,80,7,7,0,8,91,0,8,27,0,9,150,84,7,67,0,8,123,0,8,59,0,9,214,82,7,19,0,8,107,0,8,43,0,9,182,0,8,11,0,8,139,0,8,75,0,9,246,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,206,81,7,15,0,8,103,0,8,39,0,9,174,0,8,7,0,8,135,0,8,71,0,9,238,80,7,9,0,8,95,0,8,31,0,9,158,84,7,99,0,8,127,0,8,63,0,9,222,
82,7,27,0,8,111,0,8,47,0,9,190,0,8,15,0,8,143,0,8,79,0,9,254,96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,193,80,7,10,0,8,96,0,8,32,0,9,161,0,8,0,0,8,128,0,8,64,0,9,225,80,7,6,0,8,88,0,8,24,0,9,145,83,7,59,0,8,120,0,8,56,0,9,209,81,7,17,0,8,104,0,8,40,0,9,177,0,8,8,0,8,136,0,8,72,0,9,241,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,201,81,7,13,0,8,100,0,8,36,0,9,169,0,8,4,0,8,132,0,8,68,0,9,233,80,7,8,0,8,92,0,8,28,0,9,153,84,7,83,0,8,124,0,8,60,0,9,217,82,7,23,0,8,108,0,
8,44,0,9,185,0,8,12,0,8,140,0,8,76,0,9,249,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,197,81,7,11,0,8,98,0,8,34,0,9,165,0,8,2,0,8,130,0,8,66,0,9,229,80,7,7,0,8,90,0,8,26,0,9,149,84,7,67,0,8,122,0,8,58,0,9,213,82,7,19,0,8,106,0,8,42,0,9,181,0,8,10,0,8,138,0,8,74,0,9,245,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,205,81,7,15,0,8,102,0,8,38,0,9,173,0,8,6,0,8,134,0,8,70,0,9,237,80,7,9,0,8,94,0,8,30,0,9,157,84,7,99,0,8,126,0,8,62,0,9,221,82,7,27,0,8,110,0,8,46,0,9,189,0,8,14,
0,8,142,0,8,78,0,9,253,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,195,80,7,10,0,8,97,0,8,33,0,9,163,0,8,1,0,8,129,0,8,65,0,9,227,80,7,6,0,8,89,0,8,25,0,9,147,83,7,59,0,8,121,0,8,57,0,9,211,81,7,17,0,8,105,0,8,41,0,9,179,0,8,9,0,8,137,0,8,73,0,9,243,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,203,81,7,13,0,8,101,0,8,37,0,9,171,0,8,5,0,8,133,0,8,69,0,9,235,80,7,8,0,8,93,0,8,29,0,9,155,84,7,83,0,8,125,0,8,61,0,9,219,82,7,23,0,8,109,0,8,45,0,9,187,0,8,13,0,8,141,0,8,77,0,
9,251,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,199,81,7,11,0,8,99,0,8,35,0,9,167,0,8,3,0,8,131,0,8,67,0,9,231,80,7,7,0,8,91,0,8,27,0,9,151,84,7,67,0,8,123,0,8,59,0,9,215,82,7,19,0,8,107,0,8,43,0,9,183,0,8,11,0,8,139,0,8,75,0,9,247,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,207,81,7,15,0,8,103,0,8,39,0,9,175,0,8,7,0,8,135,0,8,71,0,9,239,80,7,9,0,8,95,0,8,31,0,9,159,84,7,99,0,8,127,0,8,63,0,9,223,82,7,27,0,8,111,0,8,47,0,9,191,0,8,15,0,8,143,0,8,79,0,9,255],fixed_td=[80,
5,1,87,5,257,83,5,17,91,5,4097,81,5,5,89,5,1025,85,5,65,93,5,16385,80,5,3,88,5,513,84,5,33,92,5,8193,82,5,9,90,5,2049,86,5,129,192,5,24577,80,5,2,87,5,385,83,5,25,91,5,6145,81,5,7,89,5,1537,85,5,97,93,5,24577,80,5,4,88,5,769,84,5,49,92,5,12289,82,5,13,90,5,3073,86,5,193,192,5,24577],cplens=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],cplext=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,112,112],cpdist=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,
129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],cpdext=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13];function ZStream(){}ZStream.prototype.inflateInit=function(a,b){a||(a=DEF_WBITS);b&&(b=!1);this.istate=new Inflate;return this.istate.inflateInit(this,b?-a:a)};ZStream.prototype.inflate=function(a){if(this.istate==null)return Z_STREAM_ERROR;return this.istate.inflate(this,a)};
ZStream.prototype.inflateEnd=function(){if(this.istate==null)return Z_STREAM_ERROR;var a=istate.inflateEnd(this);this.istate=null;return a};ZStream.prototype.inflateSync=function(){return istate.inflateSync(this)};ZStream.prototype.inflateSetDictionary=function(a,b){return istate.inflateSetDictionary(this,a,b)};function Inflate(){this.was=[0]}
Inflate.prototype.inflateReset=function(a){if(a==null||a.istate==null)return Z_STREAM_ERROR;a.total_in=a.total_out=0;a.msg=null;a.istate.mode=a.istate.nowrap!=0?BLOCKS:METHOD;a.istate.blocks.reset(a,null);return Z_OK};Inflate.prototype.inflateEnd=function(a){this.blocks!=null&&this.blocks.free(a);this.blocks=null;return Z_OK};
Inflate.prototype.inflateInit=function(a,b){this.blocks=a.msg=null;nowrap=0;b<0&&(b=-b,nowrap=1);if(b<8||b>15)return this.inflateEnd(a),Z_STREAM_ERROR;this.wbits=b;a.istate.blocks=new InfBlocks(a,a.istate.nowrap!=0?null:this,1<<b);this.inflateReset(a);return Z_OK};
Inflate.prototype.inflate=function(a,b){var c,d;if(a==null||a.istate==null||a.next_in==null)return Z_STREAM_ERROR;b=b==Z_FINISH?Z_BUF_ERROR:Z_OK;for(c=Z_BUF_ERROR;;)switch(a.istate.mode){case METHOD:if(a.avail_in==0)return c;c=b;a.avail_in--;a.total_in++;if(((a.istate.method=a.next_in[a.next_in_index++])&15)!=Z_DEFLATED){a.istate.mode=BAD;a.msg="unknown compression method";a.istate.marker=5;break}if((a.istate.method>>4)+8>a.istate.wbits){a.istate.mode=BAD;a.msg="invalid window size";a.istate.marker=
5;break}a.istate.mode=FLAG;case FLAG:if(a.avail_in==0)return c;c=b;a.avail_in--;a.total_in++;d=a.next_in[a.next_in_index++]&255;if(((a.istate.method<<8)+d)%31!=0){a.istate.mode=BAD;a.msg="incorrect header check";a.istate.marker=5;break}if((d&PRESET_DICT)==0){a.istate.mode=BLOCKS;break}a.istate.mode=DICT4;case DICT4:if(a.avail_in==0)return c;c=b;a.avail_in--;a.total_in++;a.istate.need=(a.next_in[a.next_in_index++]&255)<<24&4278190080;a.istate.mode=DICT3;case DICT3:if(a.avail_in==0)return c;c=b;a.avail_in--;
a.total_in++;a.istate.need+=(a.next_in[a.next_in_index++]&255)<<16&16711680;a.istate.mode=DICT2;case DICT2:if(a.avail_in==0)return c;c=b;a.avail_in--;a.total_in++;a.istate.need+=(a.next_in[a.next_in_index++]&255)<<8&65280;a.istate.mode=DICT1;case DICT1:if(a.avail_in==0)return c;a.avail_in--;a.total_in++;a.istate.need+=a.next_in[a.next_in_index++]&255;a.adler=a.istate.need;a.istate.mode=DICT0;return Z_NEED_DICT;case DICT0:return a.istate.mode=BAD,a.msg="need dictionary",a.istate.marker=0,Z_STREAM_ERROR;
case BLOCKS:c=a.istate.blocks.proc(a,c);if(c==Z_DATA_ERROR){a.istate.mode=BAD;a.istate.marker=0;break}c==Z_OK&&(c=b);if(c!=Z_STREAM_END)return c;c=b;a.istate.blocks.reset(a,a.istate.was);if(a.istate.nowrap!=0){a.istate.mode=DONE;break}a.istate.mode=CHECK4;case CHECK4:if(a.avail_in==0)return c;c=b;a.avail_in--;a.total_in++;a.istate.need=(a.next_in[a.next_in_index++]&255)<<24&4278190080;a.istate.mode=CHECK3;case CHECK3:if(a.avail_in==0)return c;c=b;a.avail_in--;a.total_in++;a.istate.need+=(a.next_in[a.next_in_index++]&
255)<<16&16711680;a.istate.mode=CHECK2;case CHECK2:if(a.avail_in==0)return c;c=b;a.avail_in--;a.total_in++;a.istate.need+=(a.next_in[a.next_in_index++]&255)<<8&65280;a.istate.mode=CHECK1;case CHECK1:if(a.avail_in==0)return c;c=b;a.avail_in--;a.total_in++;a.istate.need+=a.next_in[a.next_in_index++]&255;if(a.istate.was[0]!=a.istate.need){a.istate.mode=BAD;a.msg="incorrect data check";a.istate.marker=5;break}a.istate.mode=DONE;case DONE:return Z_STREAM_END;case BAD:return Z_DATA_ERROR;default:return Z_STREAM_ERROR}};
Inflate.prototype.inflateSetDictionary=function(a,b,c){var d=0,e=c;if(a==null||a.istate==null||a.istate.mode!=DICT0)return Z_STREAM_ERROR;if(a._adler.adler32(1,b,0,c)!=a.adler)return Z_DATA_ERROR;a.adler=a._adler.adler32(0,null,0,0);e>=1<<a.istate.wbits&&(e=(1<<a.istate.wbits)-1,d=c-e);a.istate.blocks.set_dictionary(b,d,e);a.istate.mode=BLOCKS;return Z_OK};var mark=[0,0,255,255];
Inflate.prototype.inflateSync=function(a){var b,c,d;if(a==null||a.istate==null)return Z_STREAM_ERROR;if(a.istate.mode!=BAD)a.istate.mode=BAD,a.istate.marker=0;if((b=a.avail_in)==0)return Z_BUF_ERROR;c=a.next_in_index;for(d=a.istate.marker;b!=0&&d<4;)a.next_in[c]==mark[d]?d++:d=a.next_in[c]!=0?0:4-d,c++,b--;a.total_in+=c-a.next_in_index;a.next_in_index=c;a.avail_in=b;a.istate.marker=d;if(d!=4)return Z_DATA_ERROR;b=a.total_in;c=a.total_out;this.inflateReset(a);a.total_in=b;a.total_out=c;a.istate.mode=
BLOCKS;return Z_OK};Inflate.prototype.inflateSyncPoint=function(a){if(a==null||a.istate==null||a.istate.blocks==null)return Z_STREAM_ERROR;return a.istate.blocks.sync_point()};var INFBLOCKS_BORDER=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];
function InfBlocks(a,b,c){this.hufts=new Int32Array(MANY*3);this.window=new Uint8Array(c);this.end=c;this.checkfn=b;this.mode=IB_TYPE;this.reset(a,null);this.index=this.table=this.left=0;this.blens=null;this.bb=new Int32Array(1);this.tb=new Int32Array(1);this.codes=new InfCodes;this.check=this.write=this.read=this.bitb=this.bitk=this.last=0;this.inftree=new InfTree}
InfBlocks.prototype.reset=function(a,b){if(b)b[0]=this.check;this.mode==IB_CODES&&this.codes.free(a);this.mode=IB_TYPE;this.read=this.write=this.bitb=this.bitk=0;if(this.checkfn)a.adler=this.check=a._adler.adler32(0,null,0,0)};
InfBlocks.prototype.proc=function(a,b){var c,d,e,g,i,j,k;g=a.next_in_index;i=a.avail_in;d=this.bitb;e=this.bitk;j=this.write;for(k=j<this.read?this.read-j-1:this.end-j;;)switch(this.mode){case IB_TYPE:for(;e<3;){if(i!=0)b=Z_OK;else return this.bitb=d,this.bitk=e,a.avail_in=i,a.total_in+=g-a.next_in_index,a.next_in_index=g,this.write=j,this.inflate_flush(a,b);i--;d|=(a.next_in[g++]&255)<<e;e+=8}c=d&7;this.last=c&1;switch(c>>>1){case 0:d>>>=3;e-=3;c=e&7;d>>>=c;e-=c;this.mode=IB_LENS;break;case 1:var l=
new Int32Array(1),n=new Int32Array(1),o=[],m=[];inflate_trees_fixed(l,n,o,m,a);this.codes.init(l[0],n[0],o[0],0,m[0],0,a);d>>>=3;e-=3;this.mode=IB_CODES;break;case 2:d>>>=3;e-=3;this.mode=IB_TABLE;break;case 3:return d>>>=3,e-=3,this.mode=BAD,a.msg="invalid block type",b=Z_DATA_ERROR,this.bitb=d,this.bitk=e,a.avail_in=i,a.total_in+=g-a.next_in_index,a.next_in_index=g,this.write=j,this.inflate_flush(a,b)}break;case IB_LENS:for(;e<32;){if(i!=0)b=Z_OK;else return this.bitb=d,this.bitk=e,a.avail_in=i,
a.total_in+=g-a.next_in_index,a.next_in_index=g,this.write=j,this.inflate_flush(a,b);i--;d|=(a.next_in[g++]&255)<<e;e+=8}if((~d>>>16&65535)!=(d&65535))return this.mode=BAD,a.msg="invalid stored block lengths",b=Z_DATA_ERROR,this.bitb=d,this.bitk=e,a.avail_in=i,a.total_in+=g-a.next_in_index,a.next_in_index=g,this.write=j,this.inflate_flush(a,b);this.left=d&65535;d=e=0;this.mode=left!=0?IB_STORED:this.last!=0?IB_DRY:IB_TYPE;break;case IB_STORED:if(i==0)return this.bitb=d,this.bitk=e,a.avail_in=i,a.total_in+=
g-a.next_in_index,a.next_in_index=g,write=j,this.inflate_flush(a,b);if(k==0&&(j==end&&read!=0&&(j=0,k=j<this.read?this.read-j-1:this.end-j),k==0&&(this.write=j,b=this.inflate_flush(a,b),j=this.write,k=j<this.read?this.read-j-1:this.end-j,j==this.end&&this.read!=0&&(j=0,k=j<this.read?this.read-j-1:this.end-j),k==0)))return this.bitb=d,this.bitk=e,a.avail_in=i,a.total_in+=g-a.next_in_index,a.next_in_index=g,this.write=j,this.inflate_flush(a,b);b=Z_OK;c=this.left;c>i&&(c=i);c>k&&(c=k);arrayCopy(a.next_in,
g,window,j,c);g+=c;i-=c;j+=c;k-=c;if((this.left-=c)!=0)break;this.mode=this.last!=0?IB_DRY:IB_TYPE;break;case IB_TABLE:for(;e<14;){if(i!=0)b=Z_OK;else return this.bitb=d,this.bitk=e,a.avail_in=i,a.total_in+=g-a.next_in_index,a.next_in_index=g,this.write=j,this.inflate_flush(a,b);i--;d|=(a.next_in[g++]&255)<<e;e+=8}this.table=c=d&16383;if((c&31)>29||(c>>5&31)>29)return this.mode=IB_BAD,a.msg="too many length or distance symbols",b=Z_DATA_ERROR,this.bitb=d,this.bitk=e,a.avail_in=i,a.total_in+=g-a.next_in_index,
a.next_in_index=g,this.write=j,this.inflate_flush(a,b);c=258+(c&31)+(c>>5&31);if(this.blens==null||this.blens.length<c)this.blens=new Int32Array(c);else for(k=0;k<c;k++)this.blens[k]=0;d>>>=14;e-=14;this.index=0;mode=IB_BTREE;case IB_BTREE:for(;this.index<4+(this.table>>>10);){for(;e<3;){if(i!=0)b=Z_OK;else return this.bitb=d,this.bitk=e,a.avail_in=i,a.total_in+=g-a.next_in_index,a.next_in_index=g,this.write=j,this.inflate_flush(a,b);i--;d|=(a.next_in[g++]&255)<<e;e+=8}this.blens[INFBLOCKS_BORDER[this.index++]]=
d&7;d>>>=3;e-=3}for(;this.index<19;)this.blens[INFBLOCKS_BORDER[this.index++]]=0;this.bb[0]=7;c=this.inftree.inflate_trees_bits(this.blens,this.bb,this.tb,this.hufts,a);if(c!=Z_OK){b=c;if(b==Z_DATA_ERROR)this.blens=null,this.mode=IB_BAD;this.bitb=d;this.bitk=e;a.avail_in=i;a.total_in+=g-a.next_in_index;a.next_in_index=g;write=j;return this.inflate_flush(a,b)}this.index=0;this.mode=IB_DTREE;case IB_DTREE:for(;;){c=this.table;if(!(this.index<258+(c&31)+(c>>5&31)))break;for(c=this.bb[0];e<c;){if(i!=
0)b=Z_OK;else return this.bitb=d,this.bitk=e,a.avail_in=i,a.total_in+=g-a.next_in_index,a.next_in_index=g,this.write=j,this.inflate_flush(a,b);i--;d|=(a.next_in[g++]&255)<<e;e+=8}c=this.hufts[(this.tb[0]+(d&inflate_mask[c]))*3+1];n=this.hufts[(this.tb[0]+(d&inflate_mask[c]))*3+2];if(n<16)d>>>=c,e-=c,this.blens[this.index++]=n;else{k=n==18?7:n-14;for(l=n==18?11:3;e<c+k;){if(i!=0)b=Z_OK;else return this.bitb=d,this.bitk=e,a.avail_in=i,a.total_in+=g-a.next_in_index,a.next_in_index=g,this.write=j,this.inflate_flush(a,
b);i--;d|=(a.next_in[g++]&255)<<e;e+=8}d>>>=c;e-=c;l+=d&inflate_mask[k];d>>>=k;e-=k;k=this.index;c=this.table;if(k+l>258+(c&31)+(c>>5&31)||n==16&&k<1)return this.blens=null,this.mode=IB_BAD,a.msg="invalid bit length repeat",b=Z_DATA_ERROR,this.bitb=d,this.bitk=e,a.avail_in=i,a.total_in+=g-a.next_in_index,a.next_in_index=g,this.write=j,this.inflate_flush(a,b);n=n==16?this.blens[k-1]:0;do this.blens[k++]=n;while(--l!=0);this.index=k}}this.tb[0]=-1;l=new Int32Array(1);n=new Int32Array(1);o=new Int32Array(1);
m=new Int32Array(1);l[0]=9;n[0]=6;c=this.table;c=this.inftree.inflate_trees_dynamic(257+(c&31),1+(c>>5&31),this.blens,l,n,o,m,this.hufts,a);if(c!=Z_OK){if(c==Z_DATA_ERROR)this.blens=null,this.mode=BAD;b=c;this.bitb=d;this.bitk=e;a.avail_in=i;a.total_in+=g-a.next_in_index;a.next_in_index=g;this.write=j;return this.inflate_flush(a,b)}this.codes.init(l[0],n[0],this.hufts,o[0],this.hufts,m[0],a);this.mode=IB_CODES;case IB_CODES:this.bitb=d;this.bitk=e;a.avail_in=i;a.total_in+=g-a.next_in_index;a.next_in_index=
g;this.write=j;if((b=this.codes.proc(this,a,b))!=Z_STREAM_END)return this.inflate_flush(a,b);b=Z_OK;this.codes.free(a);g=a.next_in_index;i=a.avail_in;d=this.bitb;e=this.bitk;j=this.write;k=j<this.read?this.read-j-1:this.end-j;if(this.last==0){this.mode=IB_TYPE;break}this.mode=IB_DRY;case IB_DRY:this.write=j;b=this.inflate_flush(a,b);j=this.write;if(this.read!=this.write)return this.bitb=d,this.bitk=e,a.avail_in=i,a.total_in+=g-a.next_in_index,a.next_in_index=g,this.write=j,this.inflate_flush(a,b);
mode=DONE;case IB_DONE:return b=Z_STREAM_END,this.bitb=d,this.bitk=e,a.avail_in=i,a.total_in+=g-a.next_in_index,a.next_in_index=g,this.write=j,this.inflate_flush(a,b);case IB_BAD:return b=Z_DATA_ERROR,this.bitb=d,this.bitk=e,a.avail_in=i,a.total_in+=g-a.next_in_index,a.next_in_index=g,this.write=j,this.inflate_flush(a,b);default:return b=Z_STREAM_ERROR,this.bitb=d,this.bitk=e,a.avail_in=i,a.total_in+=g-a.next_in_index,a.next_in_index=g,this.write=j,this.inflate_flush(a,b)}};
InfBlocks.prototype.free=function(a){this.reset(a,null);this.hufts=this.window=null};InfBlocks.prototype.set_dictionary=function(a,b,c){arrayCopy(a,b,window,0,c);this.read=this.write=c};InfBlocks.prototype.sync_point=function(){return this.mode==IB_LENS};
InfBlocks.prototype.inflate_flush=function(a,b){var c,d,e;d=a.next_out_index;e=this.read;c=(e<=this.write?this.write:this.end)-e;if(c>a.avail_out)c=a.avail_out;c!=0&&b==Z_BUF_ERROR&&(b=Z_OK);a.avail_out-=c;a.total_out+=c;if(this.checkfn!=null)a.adler=this.check=a._adler.adler32(this.check,this.window,e,c);arrayCopy(this.window,e,a.next_out,d,c);d+=c;e+=c;if(e==this.end){e=0;if(this.write==this.end)this.write=0;c=this.write-e;if(c>a.avail_out)c=a.avail_out;c!=0&&b==Z_BUF_ERROR&&(b=Z_OK);a.avail_out-=
c;a.total_out+=c;if(this.checkfn!=null)a.adler=this.check=a._adler.adler32(this.check,this.window,e,c);arrayCopy(this.window,e,a.next_out,d,c);d+=c;e+=c}a.next_out_index=d;this.read=e;return b};var IC_START=0,IC_LEN=1,IC_LENEXT=2,IC_DIST=3,IC_DISTEXT=4,IC_COPY=5,IC_LIT=6,IC_WASH=7,IC_END=8,IC_BADCODE=9;function InfCodes(){}InfCodes.prototype.init=function(a,b,c,d,e,g){this.mode=IC_START;this.lbits=a;this.dbits=b;this.ltree=c;this.ltree_index=d;this.dtree=e;this.dtree_index=g;this.tree=null};
InfCodes.prototype.proc=function(a,b,c){var d,e,g=0,i=0,j=0,k,l,n;j=b.next_in_index;k=b.avail_in;g=a.bitb;i=a.bitk;l=a.write;for(n=l<a.read?a.read-l-1:a.end-l;;)switch(this.mode){case IC_START:if(n>=258&&k>=10&&(a.bitb=g,a.bitk=i,b.avail_in=k,b.total_in+=j-b.next_in_index,b.next_in_index=j,a.write=l,c=this.inflate_fast(this.lbits,this.dbits,this.ltree,this.ltree_index,this.dtree,this.dtree_index,a,b),j=b.next_in_index,k=b.avail_in,g=a.bitb,i=a.bitk,l=a.write,n=l<a.read?a.read-l-1:a.end-l,c!=Z_OK)){this.mode=
c==Z_STREAM_END?IC_WASH:IC_BADCODE;break}this.need=this.lbits;this.tree=this.ltree;this.tree_index=this.ltree_index;this.mode=IC_LEN;case IC_LEN:for(d=this.need;i<d;){if(k!=0)c=Z_OK;else return a.bitb=g,a.bitk=i,b.avail_in=k,b.total_in+=j-b.next_in_index,b.next_in_index=j,a.write=l,a.inflate_flush(b,c);k--;g|=(b.next_in[j++]&255)<<i;i+=8}d=(this.tree_index+(g&inflate_mask[d]))*3;g>>>=this.tree[d+1];i-=this.tree[d+1];e=this.tree[d];if(e==0){this.lit=this.tree[d+2];this.mode=IC_LIT;break}if((e&16)!=
0){this.get=e&15;this.len=this.tree[d+2];this.mode=IC_LENEXT;break}if((e&64)==0){this.need=e;this.tree_index=d/3+this.tree[d+2];break}if((e&32)!=0){this.mode=IC_WASH;break}this.mode=IC_BADCODE;b.msg="invalid literal/length code";c=Z_DATA_ERROR;a.bitb=g;a.bitk=i;b.avail_in=k;b.total_in+=j-b.next_in_index;b.next_in_index=j;a.write=l;return a.inflate_flush(b,c);case IC_LENEXT:for(d=this.get;i<d;){if(k!=0)c=Z_OK;else return a.bitb=g,a.bitk=i,b.avail_in=k,b.total_in+=j-b.next_in_index,b.next_in_index=
j,a.write=l,a.inflate_flush(b,c);k--;g|=(b.next_in[j++]&255)<<i;i+=8}this.len+=g&inflate_mask[d];g>>=d;i-=d;this.need=this.dbits;this.tree=this.dtree;this.tree_index=this.dtree_index;this.mode=IC_DIST;case IC_DIST:for(d=this.need;i<d;){if(k!=0)c=Z_OK;else return a.bitb=g,a.bitk=i,b.avail_in=k,b.total_in+=j-b.next_in_index,b.next_in_index=j,a.write=l,a.inflate_flush(b,c);k--;g|=(b.next_in[j++]&255)<<i;i+=8}d=(this.tree_index+(g&inflate_mask[d]))*3;g>>=this.tree[d+1];i-=this.tree[d+1];e=this.tree[d];
if((e&16)!=0){this.get=e&15;this.dist=this.tree[d+2];this.mode=IC_DISTEXT;break}if((e&64)==0){this.need=e;this.tree_index=d/3+this.tree[d+2];break}this.mode=IC_BADCODE;b.msg="invalid distance code";c=Z_DATA_ERROR;a.bitb=g;a.bitk=i;b.avail_in=k;b.total_in+=j-b.next_in_index;b.next_in_index=j;a.write=l;return a.inflate_flush(b,c);case IC_DISTEXT:for(d=this.get;i<d;){if(k!=0)c=Z_OK;else return a.bitb=g,a.bitk=i,b.avail_in=k,b.total_in+=j-b.next_in_index,b.next_in_index=j,a.write=l,a.inflate_flush(b,
c);k--;g|=(b.next_in[j++]&255)<<i;i+=8}this.dist+=g&inflate_mask[d];g>>=d;i-=d;this.mode=IC_COPY;case IC_COPY:for(d=l-this.dist;d<0;)d+=a.end;for(;this.len!=0;){if(n==0&&(l==a.end&&a.read!=0&&(l=0,n=l<a.read?a.read-l-1:a.end-l),n==0&&(a.write=l,c=a.inflate_flush(b,c),l=a.write,n=l<a.read?a.read-l-1:a.end-l,l==a.end&&a.read!=0&&(l=0,n=l<a.read?a.read-l-1:a.end-l),n==0)))return a.bitb=g,a.bitk=i,b.avail_in=k,b.total_in+=j-b.next_in_index,b.next_in_index=j,a.write=l,a.inflate_flush(b,c);a.window[l++]=
a.window[d++];n--;d==a.end&&(d=0);this.len--}this.mode=IC_START;break;case IC_LIT:if(n==0&&(l==a.end&&a.read!=0&&(l=0,n=l<a.read?a.read-l-1:a.end-l),n==0&&(a.write=l,c=a.inflate_flush(b,c),l=a.write,n=l<a.read?a.read-l-1:a.end-l,l==a.end&&a.read!=0&&(l=0,n=l<a.read?a.read-l-1:a.end-l),n==0)))return a.bitb=g,a.bitk=i,b.avail_in=k,b.total_in+=j-b.next_in_index,b.next_in_index=j,a.write=l,a.inflate_flush(b,c);c=Z_OK;a.window[l++]=this.lit;n--;this.mode=IC_START;break;case IC_WASH:i>7&&(i-=8,k++,j--);
a.write=l;c=a.inflate_flush(b,c);l=a.write;if(a.read!=a.write)return a.bitb=g,a.bitk=i,b.avail_in=k,b.total_in+=j-b.next_in_index,b.next_in_index=j,a.write=l,a.inflate_flush(b,c);this.mode=IC_END;case IC_END:return c=Z_STREAM_END,a.bitb=g,a.bitk=i,b.avail_in=k,b.total_in+=j-b.next_in_index,b.next_in_index=j,a.write=l,a.inflate_flush(b,c);case IC_BADCODE:return c=Z_DATA_ERROR,a.bitb=g,a.bitk=i,b.avail_in=k,b.total_in+=j-b.next_in_index,b.next_in_index=j,a.write=l,a.inflate_flush(b,c);default:return c=
Z_STREAM_ERROR,a.bitb=g,a.bitk=i,b.avail_in=k,b.total_in+=j-b.next_in_index,b.next_in_index=j,a.write=l,a.inflate_flush(b,c)}};InfCodes.prototype.free=function(){};
InfCodes.prototype.inflate_fast=function(a,b,c,d,e,g,i,j){var k,l,n,o,m,p,s,q,v,w,r,u;p=j.next_in_index;s=j.avail_in;o=i.bitb;m=i.bitk;q=i.write;v=q<i.read?i.read-q-1:i.end-q;a=inflate_mask[a];w=inflate_mask[b];do{for(;m<20;)s--,o|=(j.next_in[p++]&255)<<m,m+=8;k=o&a;l=c;n=d;u=(n+k)*3;if((b=l[u])==0)o>>=l[u+1],m-=l[u+1],i.window[q++]=l[u+2],v--;else{do{o>>=l[u+1];m-=l[u+1];if((b&16)!=0){b&=15;r=l[u+2]+(o&inflate_mask[b]);o>>=b;for(m-=b;m<15;)s--,o|=(j.next_in[p++]&255)<<m,m+=8;k=o&w;l=e;n=g;u=(n+k)*
3;b=l[u];do if(o>>=l[u+1],m-=l[u+1],(b&16)!=0){for(b&=15;m<b;)s--,o|=(j.next_in[p++]&255)<<m,m+=8;k=l[u+2]+(o&inflate_mask[b]);o>>=b;m-=b;v-=r;if(q>=k)k=q-k,i.window[q++]=i.window[k++],i.window[q++]=i.window[k++],r-=2;else{k=q-k;do k+=i.end;while(k<0);b=i.end-k;if(r>b){r-=b;if(q-k>0&&b>q-k){do i.window[q++]=i.window[k++];while(--b!=0)}else arrayCopy(i.window,k,i.window,q,b),q+=b;k=0}}do i.window[q++]=i.window[k++];while(--r!=0);break}else if((b&64)==0)k+=l[u+2],k+=o&inflate_mask[b],u=(n+k)*3,b=l[u];
else return j.msg="invalid distance code",r=j.avail_in-s,r=m>>3<r?m>>3:r,s+=r,p-=r,m-=r<<3,i.bitb=o,i.bitk=m,j.avail_in=s,j.total_in+=p-j.next_in_index,j.next_in_index=p,i.write=q,Z_DATA_ERROR;while(1);break}if((b&64)==0){if(k+=l[u+2],k+=o&inflate_mask[b],u=(n+k)*3,(b=l[u])==0){o>>=l[u+1];m-=l[u+1];i.window[q++]=l[u+2];v--;break}}else return(b&32)!=0?(r=j.avail_in-s,r=m>>3<r?m>>3:r,s+=r,p-=r,m-=r<<3,i.bitb=o,i.bitk=m,j.avail_in=s,j.total_in+=p-j.next_in_index,j.next_in_index=p,i.write=q,Z_STREAM_END):
(j.msg="invalid literal/length code",r=j.avail_in-s,r=m>>3<r?m>>3:r,s+=r,p-=r,m-=r<<3,i.bitb=o,i.bitk=m,j.avail_in=s,j.total_in+=p-j.next_in_index,j.next_in_index=p,i.write=q,Z_DATA_ERROR)}while(1)}}while(v>=258&&s>=10);r=j.avail_in-s;r=m>>3<r?m>>3:r;s+=r;p-=r;m-=r<<3;i.bitb=o;i.bitk=m;j.avail_in=s;j.total_in+=p-j.next_in_index;j.next_in_index=p;i.write=q;return Z_OK};function InfTree(){}
InfTree.prototype.huft_build=function(a,b,c,d,e,g,i,j,k,l,n){var o,m,p,s,q,v,w,r,u;v=0;m=c;do this.c[a[b+v]]++,v++,m--;while(m!=0);if(this.c[0]==c)return i[0]=-1,j[0]=0,Z_OK;q=j[0];for(p=1;p<=BMAX;p++)if(this.c[p]!=0)break;s=p;q<p&&(q=p);for(m=BMAX;m!=0;m--)if(this.c[m]!=0)break;l=m;q>m&&(q=m);j[0]=q;for(j=1<<p;p<m;p++,j<<=1)if((j-=this.c[p])<0)return Z_DATA_ERROR;if((j-=this.c[m])<0)return Z_DATA_ERROR;this.c[m]+=j;this.x[1]=p=0;v=1;for(w=2;--m!=0;)this.x[w]=p+=this.c[v],w++,v++;v=m=0;do{if((p=a[b+
v])!=0)this.v[this.x[p]++]=m;v++}while(++m<c);c=this.x[l];v=this.x[0]=m=0;b=-1;r=-q;for(u=w=this.u[0]=0;s<=l;s++)for(a=this.c[s];a--!=0;){for(;s>r+q;){b++;r+=q;u=l-r;u=u>q?q:u;if((o=1<<(p=s-r))>a+1)if(o-=a+1,w=s,p<u)for(;++p<u;){if((o<<=1)<=this.c[++w])break;o-=this.c[w]}u=1<<p;if(this.hn[0]+u>MANY)return Z_DATA_ERROR;this.u[b]=w=this.hn[0];this.hn[0]+=u;b!=0?(this.x[b]=m,this.r[0]=p,this.r[1]=q,p=m>>>r-q,this.r[2]=w-this.u[b-1]-p,arrayCopy(this.r,0,k,(this.u[b-1]+p)*3,3)):i[0]=w}this.r[1]=s-r;v>=
c?this.r[0]=192:n[v]<d?(this.r[0]=this.v[v]<256?0:96,this.r[2]=this.v[v++]):(this.r[0]=g[this.v[v]-d]+16+64,this.r[2]=e[this.v[v++]-d]);o=1<<s-r;for(p=m>>>r;p<u;p+=o)arrayCopy(this.r,0,k,(w+p)*3,3);for(p=1<<s-1;(m&p)!=0;p>>>=1)m^=p;m^=p;for(p=(1<<r)-1;(m&p)!=this.x[b];)b--,r-=q,p=(1<<r)-1}return j!=0&&l!=1?Z_BUF_ERROR:Z_OK};
InfTree.prototype.inflate_trees_bits=function(a,b,c,d,e){this.initWorkArea(19);this.hn[0]=0;a=this.huft_build(a,0,19,19,null,null,c,b,d,this.hn,this.v);if(a==Z_DATA_ERROR)e.msg="oversubscribed dynamic bit lengths tree";else if(a==Z_BUF_ERROR||b[0]==0)e.msg="incomplete dynamic bit lengths tree",a=Z_DATA_ERROR;return a};
InfTree.prototype.inflate_trees_dynamic=function(a,b,c,d,e,g,i,j,k){this.initWorkArea(288);this.hn[0]=0;g=this.huft_build(c,0,a,257,cplens,cplext,g,d,j,this.hn,this.v);if(g!=Z_OK||d[0]==0){if(g==Z_DATA_ERROR)k.msg="oversubscribed literal/length tree";else if(g!=Z_MEM_ERROR)k.msg="incomplete literal/length tree",g=Z_DATA_ERROR;return g}this.initWorkArea(288);g=this.huft_build(c,a,b,0,cpdist,cpdext,i,e,j,this.hn,this.v);if(g!=Z_OK||e[0]==0&&a>257){if(g==Z_DATA_ERROR)k.msg="oversubscribed distance tree";
else if(g==Z_BUF_ERROR)k.msg="incomplete distance tree",g=Z_DATA_ERROR;else if(g!=Z_MEM_ERROR)k.msg="empty distance tree with lengths",g=Z_DATA_ERROR;return g}return Z_OK};function inflate_trees_fixed(a,b,c,d){a[0]=fixed_bl;b[0]=fixed_bd;c[0]=fixed_tl;d[0]=fixed_td;return Z_OK}
InfTree.prototype.initWorkArea=function(a){if(this.hn==null)this.hn=new Int32Array(1),this.v=new Int32Array(a),this.c=new Int32Array(BMAX+1),this.r=new Int32Array(3),this.u=new Int32Array(BMAX),this.x=new Int32Array(BMAX+1);if(this.v.length<a)this.v=new Int32Array(a);for(var b=0;b<a;b++)this.v[b]=0;for(b=0;b<BMAX+1;b++)this.c[b]=0;for(b=0;b<3;b++)this.r[b]=0;arrayCopy(this.c,0,this.u,0,BMAX);arrayCopy(this.c,0,this.x,0,BMAX+1)};
var testArray=new Uint8Array(1),hasSubarray=typeof testArray.subarray==="function",hasSlice=!1;function arrayCopy(a,b,c,d,e){if(e!=0){if(a){if(!c)throw"Undef dest";}else throw"Undef src";b==0&&e==a.length?arrayCopy_fast(a,c,d):hasSubarray?arrayCopy_fast(a.subarray(b,b+e),c,d):a.BYTES_PER_ELEMENT==1&&e>100?arrayCopy_fast(new Uint8Array(a.buffer,a.byteOffset+b,e),c,d):arrayCopy_slow(a,b,c,d,e)}}function arrayCopy_slow(a,b,c,d,e){for(var g=0;g<e;++g)c[d+g]=a[b+g]}
function arrayCopy_fast(a,b,c){b.set(a,c)}var ADLER_BASE=65521,ADLER_NMAX=5552;
function adler32(a,b,c,d){if(b==null)return 1;var e=a&65535;a=a>>16&65535;for(var g;d>0;){g=d<ADLER_NMAX?d:ADLER_NMAX;for(d-=g;g>=16;)e+=b[c++]&255,a+=e,e+=b[c++]&255,a+=e,e+=b[c++]&255,a+=e,e+=b[c++]&255,a+=e,e+=b[c++]&255,a+=e,e+=b[c++]&255,a+=e,e+=b[c++]&255,a+=e,e+=b[c++]&255,a+=e,e+=b[c++]&255,a+=e,e+=b[c++]&255,a+=e,e+=b[c++]&255,a+=e,e+=b[c++]&255,a+=e,e+=b[c++]&255,a+=e,e+=b[c++]&255,a+=e,e+=b[c++]&255,a+=e,e+=b[c++]&255,a+=e,g-=16;if(g!=0){do e+=b[c++]&255,a+=e;while(--g!=0)}e%=ADLER_BASE;
a%=ADLER_BASE}return a<<16|e}
function jszlib_inflate_buffer(a,b,c,d){a=b?new Uint8Array(a,b,c):new Uint8Array(a);c=new ZStream;c.inflateInit(DEF_WBITS,!0);c.next_in=a;c.next_in_index=0;c.avail_in=a.length;a=[];for(var e=0;;){var g=new Uint8Array(32E3);c.next_out=g;c.next_out_index=0;c.avail_out=g.length;var i=c.inflate(Z_NO_FLUSH);if(i!=Z_OK&&i!=Z_STREAM_END)throw c.msg;if(c.avail_out!=0){var j=new Uint8Array(g.length-c.avail_out);arrayCopy(g,0,j,0,g.length-c.avail_out);g=j}a.push(g);e+=g.length;if(i==Z_STREAM_END)break}d&&(d[0]=
(b||0)+c.next_in_index);if(a.length==1)return a[0].buffer;else{b=new Uint8Array(e);for(c=d=0;c<a.length;++c)e=a[c],arrayCopy(e,0,b,d,e.length),d+=e.length;return b.buffer}};(function(){var a=!1,b=/xyz/.test(function(){})?/\b_super\b/:/.*/;this.Class=function(){};Class.extend=function(c){function d(){!a&&this.init&&this.init.apply(this,arguments)}var e=this.prototype;a=!0;var g=new this;a=!1;for(var i in c)g[i]=typeof c[i]=="function"&&typeof e[i]=="function"&&b.test(c[i])?function(a,b){return function(){var c=this._super;this._super=e[a];var d=b.apply(this,arguments);this._super=c;return d}}(i,c[i]):c[i];d.prototype=g;d.constructor=d;d.extend=arguments.callee;return d}})();var Scribl=Class.extend({init:function(a,b){this.scrolled=!1;var c=a.getContext("2d");this.width=b;this.laneSizes=50;this.laneBuffer=5;this.trackBuffer=25;this.offset=void 0;this.canvas=a;this.ctx=c;this.scale={};this.scale.pretty=!0;this.scale.max=void 0;this.scale.min=void 0;this.scale.auto=!0;this.scale.userControlled=!1;this.scale.positions=[0];this.scale.off=!1;this.scale.size=15;this.scale.font={};this.scale.font.size=15;this.scale.font.color="black";this.scale.font.buffer=10;this.glyph={};
this.glyph.roundness=6;this.glyph.borderWidth=1;this.glyph.color=["#99CCFF","rgb(63, 128, 205)"];this.glyph.text={};this.glyph.text.color="black";this.glyph.text.size="13";this.glyph.text.font="arial";this.glyph.text.align="center";this.gene={};this.gene.text={};this.protein={};this.protein.text={};this.events={};this.events.hasClick=!1;this.events.hasMouseover=!1;this.events.clicks=[];this.events.mouseovers=[];this.events.added=!1;this.tick={};this.tick.auto=!0;this.tick.major={};this.tick.major.size=
10;this.tick.major.color="black";this.tick.minor={};this.tick.minor.size=1;this.tick.minor.color="rgb(55,55,55)";this.tick.halfColor="rgb(10,10,10)";this.tooltips={};this.tooltips.text={};this.tooltips.text.font="arial";this.tooltips.text.size=12;this.tooltips.borderWidth=1;this.tooltips.roundness=5;this.tooltips.fade=!1;this.tooltips.style="light";this.scrollable=!1;this.scrollValues=[0,void 0];this.chars={};this.chars.nt_color="white";this.chars.nt_A_bg="red";this.chars.nt_G_bg="blue";this.chars.nt_C_bg=
"green";this.chars.nt_T_bg="black";this.chars.canvasHolder=document.createElement("canvas");this.drawStyle="expand";this.myMouseEventHandler=new MouseEventHandler(this);this.tracks=[]},getScaleHeight:function(){return this.scale.font.size+this.scale.size},getHeight:function(){var a=0;this.scale.off||(a+=this.getScaleHeight());for(var b=this.tracks.length,c=0;c<b;c++)a+=this.trackBuffer,a+=this.tracks[c].getHeight();return a},addScale:function(){this.scale.userControlled?this.scale.positions.push(this.tracks.length):
(this.scale.positions=[this.tracks.length],this.scale.userControlled=!0)},addTrack:function(){var a=new Track(this.ctx);a.chart=this;if(this.tracks.length==1&&this.tracks[0]==void 0)this.tracks=[];this.tracks.push(a);return a},loadGenbank:function(a){genbank(a,this)},loadBed:function(a){bed(a,this)},loadBam:function(a,b,c,d,e,g){var i=this;makeBam(new BlobFetchable(a),new BlobFetchable(b),function(a){a.fetch(c,d,e,function(a,b){if(a){for(var c=0;c<a.length;c+=1)i.addFeature(new BlockArrow("bam",a[c].pos,
a[c].lengthOnRef,"+",{seq:a[c].seq}));g()}b&&alert("error: "+b)})})},loadFeatures:function(a){for(var b=0;b<a.length;b++)this.addFeature(a[b])},addGene:function(a,b,c,d){return this.addFeature(new BlockArrow("gene",a,b,c,d))},addProtein:function(a,b,c,d){return this.addFeature(new BlockArrow("protein",a,b,c,d))},addFeature:function(a){(this.tracks[0]||this.addTrack()).addFeature(a);return a},slice:function(a,b,c){c=c||"inclusive";for(var d=this.tracks.length,e=new Scribl(this.canvas,this.width),g=
0;g<d;g++){var i=this.tracks[g],j=e.addTrack();j.drawStyle=i.drawStyle;for(var k=i.lanes.length,l=0;l<k;l++){newLane=j.addLane();for(var n=i.lanes[l].features,o=0;o<n.length;o++){var m=n[o].position+n[o].length,p=n[o].position;if(c=="inclusive")p>=a&&p<=b?newLane.addFeature(n[o]):m>a&&m<b?newLane.addFeature(n[o]):p<a&&m>b?newLane.addFeature(n[o]):p>a&&m<b&&newLane.addFeature(n[o]);else if(c=="strict")if(p>=a&&p<=b)if(m>a&&m<b)newLane.addFeature(n[o]);else{var s=n[o].clone();s.length=Math.abs(b-p);
newLane.addFeature(s)}else if(m>a&&m<b)s=n[o].clone(),s.position=a,s.length=Math.abs(m-a),newLane.addFeature(s);else{if(p<a&&m>b)s=n[o].clone(),s.position=a,s.length=Math.abs(b-a),newLane.addFeature(s)}else c=="exclusive"&&p>=a&&p<=b&&m>a&&m<b&&newLane.addFeature(n[o])}}}e.laneSizes=this.laneSizes;e.drawStyle=this.drawStyle;e.glyph=this.glyph;e.loadFeatures([]);return e},draw:function(){var a=this.ctx,b=this.tracks;this.scrollable==!0&&this.initScrollable();a.save();if(this.scale.pretty){if(this.tick.auto)this.tick.major.size=
this.determineMajorTick(),this.tick.minor.size=Math.round(this.tick.major.size/10);if(this.scale.auto)this.scale.min-=this.scale.min%this.tick.major.size,this.scale.max=Math.round(this.scale.max/this.tick.major.size+0.4)*this.tick.major.size}this.offset=this.scale.min.offset?Math.ceil(a.measureText(this.getTickText(this.scale.min)).width/2+10):Math.ceil(a.measureText("0").width/2+10);a.save();for(var c=0;c<b.length;c++)!this.scale.off&&this.scale.positions.indexOf(c)!=-1&&this.drawScale(),b[c].draw();
!this.scale.off&&this.scale.positions.indexOf(b.length)!=-1&&this.drawScale();a.restore();a.restore();this.events.added||this.registerEventListeners()},redraw:function(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);this.tracks.length>0&&this.draw()},drawScale:function(){var a=this.ctx,b=a.fillStyle,c=this.scale.font.size+this.scale.size,d=this.scale.font.size+2,e=this.scale.font.size+this.scale.size*0.66,g=this.scale.font.size+this.scale.size*0.33;a.font=this.scale.font.size+"px arial";
a.textBaseline="top";a.fillStyle=this.scale.font.color;for(var i=this.scale.min%this.tick.minor.size==0?this.scale.min:this.scale.min-this.scale.min%this.tick.minor.size+this.tick.minor.size;i<=this.scale.max;i+=this.tick.minor.size){a.beginPath();var j=this.pixelsToNts(i-this.scale.min)+this.offset;if(i%this.tick.major.size==0){var k=this.getTickText(i);a.textAlign="center";a.fillText(k,j,0);a.moveTo(j,c);a.lineTo(j,d);a.strokeStyle=this.tick.major.color}else a.moveTo(j,c),i%(this.tick.major.size/
2)==0?(a.strokeStyle=this.tick.halfColor,a.lineTo(j,g)):(a.strokeStyle=this.tick.minor.color,a.lineTo(j,e));a.stroke()}a.fillStyle=b;a.translate(0,this.getScaleHeight()+this.laneBuffer)},pixelsToNts:function(a){return a==void 0?this.width/(this.scale.max-this.scale.min):this.width/(this.scale.max-this.scale.min)*a},ntsToPixels:function(a){return a==void 0?1/this.pixelsToNts():a/this.width},initScrollable:function(){var a;if(!this.scrolled){a=document.createElement("div");var b=document.createElement("div"),
c=document.createElement("div");c.id="scribl-zoom-slider";c.className="slider";c.style.cssFloat="left";c.style.height=new String(this.canvas.height*0.5)+"px";c.style.margin="30px auto auto -20px";a.style.cssText=this.canvas.style.cssText;this.canvas.style.cssText="";parentWidth=parseInt(this.canvas.width)+25;a.style.width=parentWidth+"px";b.style.width=this.canvas.width+"px";b.style.overflow="auto";b.id="scroll-wrapper";this.canvas.parentNode.replaceChild(a,this.canvas);a.appendChild(c);b.appendChild(this.canvas);
a.appendChild(b);$(b).dragscrollable({dragSelector:"canvas:first",acceptPropagatedEvent:!1})}b=this.scale.max-this.scale.min;var d=this.scrollValues[1]||this.scale.max-b*0.35;a=this.scrollValues[0]!=void 0?this.scrollValues[0]:this.scale.max+b*0.35;var e=(d-a)/document.getElementById("scroll-wrapper").style.width.split("px")[0];e=b/e;this.canvas.width=e;this.width=e-30;schart=this;d=(d-a)/(this.scale.max-this.scale.min)*100;$(c).slider({orientation:"vertical",range:"min",min:1,max:100,value:d,slide:function(a,
b){var c=schart.scale.max-schart.scale.min,d=b.value/100*schart.canvas.width,e=document.getElementById("scroll-wrapper");e=e.scrollLeft+parseInt(e.style.width.split("px")[0])/2;schart.scrollValues=[(e-d/2)/schart.canvas.width*c,(e+d/2)/schart.canvas.width*c];schart.ctx.clearRect(0,0,schart.canvas.width,schart.canvas.height);schart.draw()}});c=(a-this.scale.min)/b*this.canvas.width;document.getElementById("scroll-wrapper").scrollLeft=c;this.scrolled=!0},determineMajorTick:function(){this.ctx.font=
this.scale.font.size+"px arial";var a=(this.scale.max-this.scale.min)/(this.width/(this.ctx.measureText(this.getTickTextDecimalPlaces(this.scale.max)).width+this.scale.font.buffer)),b=Math.pow(10,parseInt(a).toString().length-1);this.tick.major.size=Math.ceil(a/b)*b;a=Math.pow(10,(this.tick.major.size+"").length);b=this.tick.major.size/a;b>0.1&&b<=0.5?b=0.5:b>0.5&&(b=1);return b*a},getTickText:function(a){if(!this.tick.auto)return a;var b=a;a>=1E6?(a=Math.pow(10,5),b=Math.round(b/1E6*a)/a+"m"):a>=
1E3&&(a=Math.pow(10,2),b=Math.round(b/1E3*a)/a+"k");return b},getTickTextDecimalPlaces:function(a){if(!this.tick.auto)return a;var b=a;a>=1E6?b=Math.round(b/(1E6/Math.pow(10,5)))+"m":a>=1E3&&(b=Math.round(b/(1E3/Math.pow(10,2)))+"k");return b},handleMouseEvent:function(a,b){this.myMouseEventHandler.setMousePosition(a);for(var c=this.myMouseEventHandler.mouseY,d,e=0;e<this.tracks.length;e++)for(var g=0;g<this.tracks[e].lanes.length;g++){var i=this.tracks[e].lanes[g].getPixelPositionY(),j=i+this.tracks[e].lanes[g].getHeight();
if(c>=i&&c<=j){d=this.tracks[e].lanes[g];break}}if(d){d.track.getDrawStyle()=="collapse"?this.redraw():(this.ctx.save(),d.erase(),this.ctx.translate(0,d.getPixelPositionY()),d.draw(),(e=this.LastToolTip)&&this.ctx.putImageData(e.pixels,e.x,e.y),this.ctx.restore());c=b=="click"?this.events.clicks:this.events.mouseovers;for(e=0;e<c.length;e++)c[e](this);this.myMouseEventHandler.reset(this)}},addClickEventListener:function(a){this.events.clicks.push(a)},addMouseoverEventListener:function(a){this.events.mouseovers.push(a)},
registerEventListeners:function(){var a=this;this.events.mouseovers.length>0&&this.canvas.addEventListener("mousemove",function(b){a.handleMouseEvent(b,"mouseover")},!1);this.events.clicks.length>0&&this.canvas.addEventListener("click",function(b){a.handleMouseEvent(b,"click")},!1);this.events.added=!0}});var Track=Class.extend({init:function(a){this.lanes=[];this.ctx=a;this.uid=_uniqueId("track");this.drawStyle=void 0;this.coverageData=[];this.maxDepth=0},addLane:function(){var a=new Lane(this.ctx,this);this.lanes.push(a);return a},addGene:function(a,b,c,d){return this.addFeature(new BlockArrow("gene",a,b,c,d))},addProtein:function(a,b,c,d){return this.addFeature(new BlockArrow("protein",a,b,c,d))},addFeature:function(a){for(var b,c=!0,d=0;d<this.lanes.length;d++){var e=this.lanes[d].features[this.lanes[d].features.length-
1];if(e!=void 0&&a.position-3/this.chart.pixelsToNts()>e.position+e.length){c=!1;b=this.lanes[d];break}}c&&(b=this.addLane());b.addFeature(a);return a},getDrawStyle:function(){return this.drawStyle?this.drawStyle:this.chart.drawStyle},getHeight:function(){var a=0,b=this.lanes.length,c=this.chart.laneBuffer,d=this.getDrawStyle();if(d=="line"||d=="collapse")b=1;for(d=0;d<b;d++)a+=c,a+=this.lanes[d].getHeight();a-=c;return a},getPixelPositionY:function(){for(var a=this.chart.getScaleHeight()+this.chart.laneBuffer,
b=0;b<this.chart.tracks.length;b++){if(this.uid==this.chart.tracks[b].uid)break;a+=this.chart.trackBuffer;a+=this.chart.tracks[b].getHeight()}return a},calcCoverageData:function(){for(var a=this.lanes,b=0;b<a.length;b++)for(var c=0;c<a[b].features.length;c++){var d=a[b].features[c],e=Math.round(d.getPixelPositionX());for(d=Math.round(e+d.getPixelLength());e<=d;e++)this.coverageData[e]=this.coverageData[e]+1||1,this.maxDepth=Math.max(this.coverageData[e],this.maxDepth)}},erase:function(){this.chart.ctx.clearRect(0,
this.getPixelPositionY(),this.chart.width,this.getHeight())},draw:function(){var a=this.getDrawStyle(),b=this.chart.laneSizes,c=this.lanes,d=this.chart.laneBuffer,e=this.chart.trackBuffer,g=b+e,i=this.ctx;if(a==void 0||a=="expand")for(a=0;a<c.length;a++)c[a].y=g,c[a].draw(),b=c[a].getHeight(),i.translate(0,b+d),g=g+b+d;else if(a=="collapse"){b=[];for(a=0;a<c.length;a++)b=b.concat(c[a].features);b.sort(function(a,b){return a.position-b.position});for(g=0;g<b.length;g++){a=b[g].length;var j=b[g].name,
k=void 0;for(k=g+1;k<b.length;k++)if(b[g].getEnd()>=b[k].position)b[g].length=Math.max(b[g].getEnd(),b[k].getEnd())-b[g].position,b[g].name="";else break;b[g].draw();b[g].length=a;b[g].name=j;g=k-1}c.length>0&&i.translate(0,c[0].getHeight()+d)}else if(a=="line"){this.coverageData.length==0&&this.calcCoverageData();g=this.maxDepth;i.beginPath();for(a=this.chart.offset;a<=this.chart.width+this.chart.offset;a++)j=this.coverageData[a]/g*b||0,j=b-j,i.lineTo(a,j);i.lineTo(this.chart.width+this.chart.offset,
b);i.stroke();i.translate(0,c[0].getHeight()+d)}i.translate(0,e-d)}});var Lane=Class.extend({init:function(a,b){this.height=void 0;this.features=[];this.ctx=a;this.track=b;this.chart=b.chart;this.uid=_uniqueId("lane")},addGene:function(a,b,c,d){return this.addFeature(new BlockArrow("gene",a,b,c,d))},addProtein:function(a,b,c,d){return this.addFeature(new BlockArrow("protein",a,b,c,d))},addFeature:function(a){a.lane=this;this.features.push(a);this.chart[a.type]||(this.chart[a.type]={text:{}});if(a.length+a.position>this.chart.scale.max||this.chart.scale.max==void 0)this.chart.scale.max=
a.length+a.position;if(a.position<this.chart.scale.min||this.chart.scale.min==void 0)this.chart.scale.min=a.position;return a},loadFeatures:function(a){for(var b=a.length,c=0;c<b;c++)this.addFeature(a[c])},getHeight:function(){return this.height!=void 0?this.height:this.chart.laneSizes},getPixelPositionY:function(){for(var a=this.track.getPixelPositionY(),b=this.getHeight(),c=0;c<this.track.lanes.length;c++){if(this.uid==this.track.lanes[c].uid)break;a+=this.track.chart.laneBuffer;a+=b}return a},
erase:function(){this.chart.ctx.clearRect(0,this.getPixelPositionY(),this.track.chart.width,this.getHeight())},draw:function(){for(var a=0;a<this.features.length;a++)this.features[a].draw()}});var tooltips=Class.extend({init:function(a){this.chart=a;this.ctx=a.ctx},fire:function(a){var b=this.ctx.globalAlpha;this.chart.tooltips.fade?h=1:this.draw(a,1);this.ctx.globalAlpha=b},draw:function(a,b){this.ctx.globalAlpha=b;var c=this.chart.tooltips.roundness,d=this.chart.tooltips.text.font,e=this.chart.tooltips.text.size;this.ctx.save();this.ctx.font=e+"px "+d;d=this.ctx.measureText(a.onMouseover);var g=[a.onMouseover],i=e+10,j=d.width+10,k=i-4,l,n;d=a.getPixelPositionX()+10;k=a.getPixelPositionY()-
k;a.getPixelLength();if(j>200)g=this.ctx.measureText("s").width,g=parseInt(200/g),g=ScriblWrapLines(g,a.onMouseover),j=210,i=g[1]*e+10,g=g[0];j+d>this.chart.width&&(d=this.chart.width-j);if(this.chart.tooltips.style=="light")l=this.chart.ctx.createLinearGradient(d+j/2,k,d+j/2,k+i),l.addColorStop(0,"rgb(253, 248, 196)"),l.addColorStop(0.75,"rgb(253, 248, 196)"),l.addColorStop(1,"white"),n=this.chart.ctx.createLinearGradient(d+j/2,k,d+j/2,k+i),n.addColorStop(0,"black"),n.addColorStop(1,"rgb(64, 64, 64)"),
this.chart.tooltips.text.color="black";else if(this.chart.tooltips.style=="dark")l=this.chart.ctx.createLinearGradient(d+j/2,k,d+j/2,k+i),l.addColorStop(0,"rgb(64, 64, 64)"),l.addColorStop(1,"rgb(121, 121, 121)"),n="white",this.chart.tooltips.text.color="white";this.chart.LastToolTip={pixels:this.ctx.getImageData(d-1,k-1,j+2,i+2),x:d-1,y:k-1};this.ctx.fillStyle=l;this.ctx.beginPath();tlc_ctrl_x=d;tlc_ctrl_y=k;tlc_lgth_x=d+c;tlc_lgth_y=k;tlc_wdth_x=d;tlc_wdth_y=k+c;blc_ctrl_x=d;blc_ctrl_y=k+i;blc_lgth_x=
d+c;blc_lgth_y=k+i;blc_wdth_x=d;blc_wdth_y=k+i-c;brc_ctrl_x=d+j;brc_ctrl_y=k+i;brc_lgth_x=d+j-c;brc_lgth_y=k+i;brc_wdth_x=d+j;brc_wdth_y=k+i-c;trc_ctrl_x=d+j;trc_ctrl_y=k;trc_lgth_x=d+j-c;trc_lgth_y=k;trc_wdth_x=d+j;trc_wdth_y=k+c;this.ctx.moveTo(tlc_lgth_x,tlc_lgth_y);this.ctx.quadraticCurveTo(tlc_ctrl_x,tlc_ctrl_y,tlc_wdth_x,tlc_wdth_y);this.ctx.lineTo(blc_wdth_x,blc_wdth_y);this.ctx.quadraticCurveTo(blc_ctrl_x,blc_ctrl_y,blc_lgth_x,blc_lgth_y);this.ctx.lineTo(brc_lgth_x,brc_lgth_y);this.ctx.quadraticCurveTo(brc_ctrl_x,
brc_ctrl_y,brc_wdth_x,brc_wdth_y);this.ctx.lineTo(trc_wdth_x,trc_wdth_y);this.ctx.quadraticCurveTo(trc_ctrl_x,trc_ctrl_y,trc_lgth_x,trc_lgth_y);this.ctx.lineTo(tlc_lgth_x,tlc_lgth_y);this.ctx.fill();this.ctx.lineWidth=this.chart.tooltips.borderWidth;this.ctx.strokeStyle=n;this.ctx.stroke();this.ctx.textBaseline="middle";this.ctx.fillStyle=this.chart.tooltips.text.color;for(c=0;c<g.length;c++)this.ctx.measureText(g[c]),this.ctx.fillText(g[c],d+5,k+e*(c+1));this.ctx.restore()}});var MouseEventHandler=Class.extend({init:function(a){this.chart=a;this.mouseY=this.mouseX=null;this.eventElement=void 0;this.isEventDetected=!1;this.tooltip=new tooltips(this.chart)},addEvents:function(a){var b=this.chart,c=b.ctx,d=b.myMouseEventHandler;if(a.onMouseover&&!b.events.hasMouseover)b.addMouseoverEventListener(b.myMouseEventHandler.handleMouseover),b.events.hasMouseover=!0;else if(a.parent&&a.parent.onMouseover&&!b.events.hasMouseover)b.addMouseoverEventListener(b.myMouseEventHandler.handleMouseover),
b.events.hasMouseover=!0;if(a.onClick&&!b.events.hasClick)b.addClickEventListener(b.myMouseEventHandler.handleClick),b.addMouseoverEventListener(b.myMouseEventHandler.handleMouseStyle),b.events.hasClick=!0;else if(a.parent&&a.parent.onClick&&!b.events.hasClick)b.addClickEventListener(b.myMouseEventHandler.handleClick),b.addMouseoverEventListener(b.myMouseEventHandler.handleMouseStyle),b.events.hasClick=!0;if(!d.isEventDetected&&c.isPointInPath_mozilla(d.mouseX,d.mouseY))d.eventElement=a,d.isEventDetected=
!0},setMousePosition:function(a){if(a!=null){var b=this.chart.canvas.getBoundingClientRect();this.mouseX=a.clientX-b.left;this.mouseY=a.clientY-b.top}},handleClick:function(a){a=a.myMouseEventHandler.eventElement;var b;if(a!=void 0&&a.onClick!=void 0)b=a.onClick;else if(a&&a.parent&&a.parent.onClick)b=a.parent.onClick;b&&(typeof b=="string"?window.open(b):typeof b=="function"&&b(a))},setMousePosition:function(a){if(a!=null){var b=this.chart.canvas.getBoundingClientRect();this.mouseX=a.clientX-b.left;
this.mouseY=a.clientY-b.top}},handleClick:function(a){a=a.myMouseEventHandler.eventElement;var b;if(a!=void 0&&a.onClick!=void 0)b=a.onClick;else if(a&&a.parent&&a.parent.onClick)b=a.parent.onClick;b&&(typeof b=="string"?window.open(b):typeof b=="function"&&b(a))},handleMouseover:function(a){a=a.myMouseEventHandler;var b=a.eventElement;if(b!=void 0&&b.onMouseover!=void 0)a.tooltip.fire(b);else if(b&&b.parent&&b.parent.onMouseover)b.onMouseover=b.parent.onMouseover,a.tooltip.fire(b)},handleMouseStyle:function(a){var b=
a.myMouseEventHandler.eventElement;a.ctx.canvas.style.cursor=b&&b.onClick!=void 0?"pointer":b&&b.parent&&b.parent.onClick!=void 0?"pointer":"auto"},reset:function(a){a=a.myMouseEventHandler;a.mouseX=null;a.mouseY=null;a.eventElement=void 0;a.isEventDetected=null;a.elementIndexCounter=0}});
CanvasRenderingContext2D.prototype.isPointInPath_mozilla=function(a,b){if(navigator.userAgent.indexOf("Firefox")!=-1){this.save();this.setTransform(1,0,0,1,0,0);var c=this.isPointInPath(a,b);this.restore()}else c=this.isPointInPath(a,b);return c};function ScriblWrapLines(a,b){for(var c=[],d="",e=0,g=(""+b).split(" "),i=0;i<g.length;i++)g[i].length+d.length<=a?d+=" "+g[i]:d==""?(trunc1=g[i].slice(0,a-1),d+=" "+trunc1+"-",trunc2=g[i].slice(a,g[i].length),g.splice(i+1,0,trunc2),c.push(d),d="",e++):(i--,c.push(d),e++,d="");e++;c.push(d);return[c,e]}var idCounter=0;_uniqueId=function(a){var b=idCounter++;return a?a+b:b};
if(!Array.prototype.indexOf)Array.prototype.indexOf=function(a){if(this===void 0||this===null)throw new TypeError;var b=Object(this),c=b.length>>>0;if(c===0)return-1;var d=0;arguments.length>0&&(d=Number(arguments[1]),d!==d?d=0:d!==0&&d!==Infinity&&d!==-Infinity&&(d=(d>0||-1)*Math.floor(Math.abs(d))));if(d>=c)return-1;for(d=d>=0?d:Math.max(c-Math.abs(d),0);d<c;d++)if(d in b&&b[d]===a)return d;return-1};var CanvasToSVG={idCounter:0,convert:function(a,b,c,d){var e=a.toDataURL(),g=document.createElementNS("http://www.w3.org/2000/svg","image");g.setAttribute("id","importedCanvas_"+this.idCounter++);g.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",e);g.setAttribute("x",c?c:0);g.setAttribute("y",d?d:0);g.setAttribute("width",a.width);g.setAttribute("height",a.height);g.imageData=a.toDataURL();b.appendChild(g)}},toXml=function(a){return $("<p/>").text(a).html()},svgToString=function(a){for(;removeUnusedDefElems()>
0;);pathActions.clear(!0);$.each(a.childNodes,function(b,c){b&&c.nodeType==8&&c.data.indexOf("Created with")>=0&&a.insertBefore(c,a.firstChild)});current_group&&(leaveContext(),selectOnly([current_group]));var b=[];$(a).find("g:data(gsvg)").each(function(){for(var a=this.attributes,c=a.length,g=0;g<c;g++)(a[g].nodeName=="id"||a[g].nodeName=="style")&&c--;if(c<=0)a=this.firstChild,b.push(a),$(this).replaceWith(a)});var c=svgToString(a,0);b.length&&$(b).each(function(){groupSvgElem(this)});return c};
svgToString=function(a,b){var c=[];if(a){var d=a.attributes,e,g,i=a.childNodes;for(g=0;g<b;g++)c.push(" ");c.push("<");c.push(a.nodeName);if(a.id=="svgcontent"){g=getResolution();c.push(' width="'+g.w+'" height="'+g.h+'" xmlns="'+svgns+'"');var j={};$(a).find("*").andSelf().each(function(){$.each(this.attributes,function(a,b){var d=b.namespaceURI;d&&!j[d]&&nsMap[d]!=="xmlns"&&nsMap[d]!=="xml"&&(j[d]=!0,c.push(" xmlns:"+nsMap[d]+'="'+d+'"'))})});for(g=d.length;g--;){e=d.item(g);var k=toXml(e.nodeValue);
if(e.nodeName.indexOf("xmlns:")!==0&&k!=""&&["width","height","xmlns","x","y","viewBox","id","overflow"].indexOf(e.localName)==-1&&(!e.namespaceURI||nsMap[e.namespaceURI]))c.push(" "),c.push(e.nodeName),c.push('="'),c.push(k),c.push('"')}}else for(g=d.length-1;g>=0;g--)e=d.item(g),k=toXml(e.nodeValue),!(["-moz-math-font-style","_moz-math-font-style"].indexOf(e.localName)>=0)&&k!=""&&k.indexOf("pointer-events")!==0&&!(e.localName==="class"&&k.indexOf("se_")===0)&&(c.push(" "),e.localName==="d"&&(k=
pathActions.convertPath(a,!0)),c.push(e.nodeName),c.push('="'),c.push(k),c.push('"'));if(a.hasChildNodes()){c.push(">");b++;d=!1;for(g=0;g<i.length;g++)switch(e=i.item(g),e.nodeType){case 1:c.push("\n");c.push(svgToString(i.item(g),b));break;case 3:e=e.nodeValue.replace(/^\s+|\s+$/g,"");e!=""&&(d=!0,c.push(toXml(e)+""));break;case 8:c.push("\n"),c.push(Array(b+1).join(" ")),c.push("<\!--"),c.push(e.data),c.push("--\>")}b--;if(!d){c.push("\n");for(g=0;g<b;g++)c.push(" ")}c.push("</");c.push(a.nodeName);
c.push(">")}else c.push("/>")}return c.join("")};var Glyph=Class.extend({init:function(a,b,c,d,e){this.uid=_uniqueId("feature");this.position=b;this.length=c;this.strand=d;this.type=a;this.name="";this.borderColor="none";this.borderWidth=void 0;this.text={};this.text.font=void 0;this.text.size=void 0;this.text.color=void 0;this.onMouseover=this.onClick=this.text.align=void 0;for(var g in e)this[g]=e[g]},setColorGradient:function(){if(arguments.length==1)this.color=arguments[0];else{for(var a=this.lane.ctx.createLinearGradient(this.length/2,0,this.length/
2,this.getHeight()),b,c=0;b=arguments[c],c<arguments.length;c++)a.addColorStop(c/(arguments.length-1),b);this.color=a}},getPixelLength:function(){return this.lane.chart.pixelsToNts(this.length)||1},getPixelPositionX:function(){var a=parseInt(this.lane.track.chart.offset)||0;return this.lane.chart.pixelsToNts(this.parent?this.position+this.parent.position-this.lane.track.chart.scale.min:this.position-this.lane.track.chart.scale.min)+a},getPixelPositionY:function(){return this.lane.getPixelPositionY()},
getEnd:function(){return this.position+this.length},clone:function(){var a=this;return a=f.orientation?eval("new"+f.glyphType+"("+f.type+","+f.position+","+f.length+","+f.orientation):eval("new"+f.glyphType+"("+f.type+","+f.position+","+f.length)},getAttr:function(a){a=a.split("-");for(var b=this,c=0;c<a.length;c++)b=b[a[c]];if(b)return b;if(this.parent){b=this.parent;for(c=0;c<a.length;c++)b=b[a[c]];if(b)return b}if(b=this.lane.chart[this.type]){for(c=0;c<a.length;c++)b=b[a[c]];if(b)return b}b=this.lane.chart.glyph;
for(c=0;c<a.length;c++)b=b[a[c]];if(b)return b},drawText:function(a){var b=this.lane.chart.ctx,c=this.getPixelLength(),d=this.getHeight(),e=this.getAttr("text-size"),g=this.getAttr("text-style");b.font=e+"px "+g;b.textBaseline="middle";b.fillStyle=this.getAttr("text-color");var i=void 0,j=this.getAttr("text-align");j=="start"?j=this.strand=="+"?"left":"right":j=="end"&&(j=this.strand=="+"?"right":"left");b.textAlign=j;j=="left"?i=5:j=="center"?i=c/2:j=="right"&&(i=c-5);var k=b.measureText(a);if(a&&
a!=""){for(;c-k.width<4;)if(e=/^\d+/.exec(b.font),e--,k=b.measureText(a),b.font=e+"px "+g,e<=8){a="";break}this.glyphType=="Complex"&&(c=0,e=/^\d+/.exec(b.font),j=="center"&&(c=-(b.measureText(a).width/2+2.5)),b.clearRect(i+c,d/2-e/2,b.measureText(a).width+5,e));b.fillText(a,i,d/2)}},calcRoundness:function(){return this.getHeight()*this.getAttr("roundness")/100},isContainedWithinRect:function(a,b,c,d){var e=this.getPixelPositionY(),g=this.getPixelPositionX(),i=this.getPixelPositionX()+this.getPixelLength(),
j=e+this.getHeight();return g>=a&&i<=c&&e>=b&&j<=d},getHeight:function(){return this.lane.getHeight()},getFillStyle:function(){var a=this.getAttr("color");if(a instanceof Array){for(var b=this.lane.ctx.createLinearGradient(this.length/2,0,this.length/2,this.getHeight()),c,d=0;c=a[d],d<a.length;d++)b.addColorStop(d/(a.length-1),c);return b}else return a instanceof Function?(b=this.lane.ctx.createLinearGradient(this.length/2,0,this.length/2,this.getHeight()),a(b)):a},getStrokeStyle:function(){var a=
this.getAttr("borderColor");if(typeof a=="object"){for(var b=this.lane.ctx.createLinearGradient(this.length/2,0,this.length/2,this.getHeight()),c,d=0;c=a[d],d<a.length;d++)b.addColorStop(d/(a.length-1),c);return b}else return a},isSubFeature:function(){return this.parent!=void 0},erase:function(){this.ctx.save();this.ctx.setTransform(1,0,0,1,0,0);this.ctx.clearRect(this.getPixelPositionX(),this.getPixelPositionY(),this.getPixelLength(),this.getHeight());this.ctx.restore()},draw:function(){this.ctx=
this.lane.chart.ctx;this.ctx.beginPath();/^\d+/.exec(this.ctx.font);var a=/\S+$/.exec(this.ctx.font);this.onClick=this.getAttr("onClick");this.onMouseover=this.getAttr("onMouseover");this.ctx.fillStyle=this.getFillStyle();var b=this.ctx.fillStyle,c=this.getPixelPositionX(),d=this.getHeight();d<10?this.ctx.font="10px "+a:this.ctx.font=d*0.9+"px "+a;this.ctx.translate(c,0);this.strand=="-"&&!this.isSubFeature()&&this.ctx.transform(-1,0,0,1,this.getPixelLength(),0);a=new Seq(this.type,this.position,
this.length,this.seq,this.opts);a.lane=this.lane;a.ctx=this.ctx;a._draw();if(this.borderColor!="none")this.color=="none"&&this.parent.glyphType=="Complex"&&this.erase(),a=this.ctx.strokeStyle,d=this.ctx.lineWidth,this.ctx.strokeStyle=this.getStrokeStyle(),this.ctx.lineWidth=this.getAttr("borderWidth"),this.ctx.stroke(),this.ctx.strokeStyle=a,this.ctx.lineWidth=d;this.color!="none"&&this.ctx.fill();this.strand=="-"&&!this.isSubFeature()&&this.ctx.transform(-1,0,0,1,this.getPixelLength(),0);this.drawText(this.getAttr("name"));
this.ctx.translate(-c,0);this.ctx.fillStyle=b;this.lane.chart.myMouseEventHandler.addEvents(this)}});var BlockArrow=Glyph.extend({init:function(a,b,c,d,e){this._super(a,b,c,d,e);this.slope=1;this.glyphType="BlockArrow"},_draw:function(a,b,c,d){a=a||this.ctx;b=b||this.getPixelLength();c=c||this.getHeight();d=d+1||this.calcRoundness();d!=void 0&&(d-=1);tc_ctrl_y=tc_ctrl_x=x=y=0;tc_lgth_x=x+d;tc_lgth_y=y;tc_wdth_x=x;tc_wdth_y=y+d;bc_ctrl_x=x;bc_ctrl_y=y+c;bc_lgth_x=x+d;bc_lgth_y=y+c;bc_wdth_x=x;bc_wdth_y=y+c-d;a_b_x=x+b-d;a_t_x=x+b-d;a_max_x=x+b;t=0.5;a_ctrl_x=(a_max_x-(1-t)*(1-t)*a_b_x-t*t*a_t_x)/
(2*(1-t)*t);a_ctrl_y=y+c/2;bs_slope=this.slope;bs_intercept=-a_ctrl_y-bs_slope*a_ctrl_x;ts_slope=-this.slope;ts_intercept=-a_ctrl_y-ts_slope*a_ctrl_x;a_b_y=-(bs_slope*a_b_x+bs_intercept);a_t_y=-(ts_slope*a_t_x+ts_intercept);bs_ctrl_y=y+c;bs_ctrl_x=(-bs_ctrl_y-bs_intercept)/this.slope;bs_ctrl_x<x?(new Rect(this.type,0,b))._draw(a,b,c,d):(bs_lgth_y=y+c,bs_lgth_x=bs_ctrl_x-d,bs_slpe_x=bs_ctrl_x+d,bs_slpe_y=-(bs_slope*bs_slpe_x+bs_intercept),ts_ctrl_y=y,ts_ctrl_x=(ts_ctrl_y+ts_intercept)/this.slope,ts_lgth_y=
y,ts_lgth_x=ts_ctrl_x-d,ts_slpe_x=ts_ctrl_x+d,ts_slpe_y=-(ts_slope*ts_slpe_x+ts_intercept),a.beginPath(),a.moveTo(tc_lgth_x,tc_lgth_y),a.quadraticCurveTo(tc_ctrl_x,tc_ctrl_y,tc_wdth_x,tc_wdth_y),a.lineTo(bc_wdth_x,bc_wdth_y),a.quadraticCurveTo(bc_ctrl_x,bc_ctrl_y,bc_lgth_x,bc_lgth_y),a.lineTo(bs_lgth_x,bs_lgth_y),a.quadraticCurveTo(bs_ctrl_x,bs_ctrl_y,bs_slpe_x,bs_slpe_y),a.lineTo(a_b_x,a_b_y),a.quadraticCurveTo(a_ctrl_x,a_ctrl_y,a_t_x,a_t_y),a.lineTo(ts_slpe_x,ts_slpe_y),a.quadraticCurveTo(ts_ctrl_x,
ts_ctrl_y,ts_lgth_x,ts_lgth_y),a.lineTo(tc_lgth_x,tc_lgth_y))}});var Rect=Glyph.extend({init:function(a,b,c,d){this._super(a,b,c,"+",d);this.glyphType="Rect"},_draw:function(a,b,c,d){a=a||this.ctx;b=b||this.getPixelLength();c=c||this.getHeight();d=d+1||this.calcRoundness();d!=void 0&&(d-=1);x=y=0;a.beginPath();tlc_ctrl_x=x;tlc_ctrl_y=y;tlc_lgth_x=x+d;tlc_lgth_y=y;tlc_wdth_x=x;tlc_wdth_y=y+d;blc_ctrl_x=x;blc_ctrl_y=y+c;blc_lgth_x=x+d;blc_lgth_y=y+c;blc_wdth_x=x;blc_wdth_y=y+c-d;brc_ctrl_x=x+b;brc_ctrl_y=y+c;brc_lgth_x=x+b-d;brc_lgth_y=y+c;brc_wdth_x=x+b;brc_wdth_y=
y+c-d;trc_ctrl_x=x+b;trc_ctrl_y=y;trc_lgth_x=x+b-d;trc_lgth_y=y;trc_wdth_x=x+b;trc_wdth_y=y+d;a.moveTo(tlc_lgth_x,tlc_lgth_y);a.quadraticCurveTo(tlc_ctrl_x,tlc_ctrl_y,tlc_wdth_x,tlc_wdth_y);a.lineTo(blc_wdth_x,blc_wdth_y);a.quadraticCurveTo(blc_ctrl_x,blc_ctrl_y,blc_lgth_x,blc_lgth_y);a.lineTo(brc_lgth_x,brc_lgth_y);a.quadraticCurveTo(brc_ctrl_x,brc_ctrl_y,brc_wdth_x,brc_wdth_y);a.lineTo(trc_wdth_x,trc_wdth_y);a.quadraticCurveTo(trc_ctrl_x,trc_ctrl_y,trc_lgth_x,trc_lgth_y);a.lineTo(tlc_lgth_x,tlc_lgth_y)}});var Line=Glyph.extend({init:function(a,b,c,d){this.thickness=2;this._super(a,b,c,"+",d);this.glyphType="Line"},_draw:function(a,b,c){a=a||this.ctx;b=b||this.getPixelLength();c=c||this.getHeight();x=y=0;a.beginPath();a.moveTo(x,c/2-this.thickness/2);a.lineTo(x,c/2+this.thickness/2);a.lineTo(x+b,c/2+this.thickness/2);a.lineTo(x+b,c/2-this.thickness/2)}});var Complex=Glyph.extend({init:function(a,b,c,d,e,g){this._super(a,b,c,d,g);this.slope=1;this.glyphType="Complex";this.subFeatures=e;this.line=new Line(a,0,c);this.line.parent=this;this.line.color="black";this.line.thickness=2},addSubFeature:function(a){this.subFeatures.push(a)},_draw:function(a,b,c,d){a=a||this.ctx;b||this.getPixelLength();c||this.getHeight();d+1||this.calcRoundness();x=y=0;a.translate(-this.getPixelPositionX(),0);this.line.lane=this.lane;this.line.draw();b=this.subFeatures.length;
for(c=0;c<b;c++)this.subFeatures[c].parent=this,this.subFeatures[c].lane=this.lane,this.subFeatures[c].draw();a.translate(this.getPixelPositionX(),0);a.beginPath()}});var Arrow=Glyph.extend({init:function(a,b,c,d){this._super(a,b,0,c,d);this.slope=1;this.glyphType="Arrow";this.thickness=4.6},getPixelThickness:function(){return this.thickness/10*(this.getHeight()/2/Math.tan(Math.atan(this.slope)))},erase:function(){var a=this.getPixelThickness();this.ctx.clearRect(-a,0,a,this.getHeight())},_draw:function(a,b,c,d){a=a||this.ctx;c=c||this.getHeight();d=d+1||this.calcRoundness();d!=void 0&&(d-=1);b=this.getPixelThickness();x=y=0;a_b_x=x-0-d;a_t_x=x-0-d;a_max_x=x-0;
t=0.5;a_ctrl_x=(a_max_x-(1-t)*(1-t)*a_b_x-t*t*a_t_x)/(2*(1-t)*t);a_ctrl_y=y+c/2;bs_slope=this.slope;bs_intercept=-a_ctrl_y-bs_slope*a_ctrl_x;ts_slope=-this.slope;ts_intercept=-a_ctrl_y-ts_slope*a_ctrl_x;a_b_y=-(bs_slope*a_b_x+bs_intercept);a_t_y=-(ts_slope*a_t_x+ts_intercept);a.beginPath();bs_ctrl_y=y+c;bs_ctrl_x=(-bs_ctrl_y-bs_intercept)/this.slope;bs_slpe_x=bs_ctrl_x+d+d;bs_slpe_y=-(bs_slope*bs_slpe_x+bs_intercept);a.moveTo(bs_slpe_x,bs_slpe_y);a.lineTo(a_b_x,a_b_y);a.quadraticCurveTo(a_ctrl_x,
a_ctrl_y,a_t_x,a_t_y);ts_ctrl_y=y;ts_ctrl_x=(ts_ctrl_y+ts_intercept)/this.slope;ts_slpe_x=ts_ctrl_x+d+d;ts_slpe_y=-(ts_slope*ts_slpe_x+ts_intercept);a.lineTo(ts_slpe_x,ts_slpe_y);var e=Math.PI-Math.abs(Math.atan(this.slope))-Math.PI/2;d=Math.sin(e)*b;e=Math.cos(e)*b;a.bezierCurveTo(ts_ctrl_x,ts_ctrl_y,ts_ctrl_x-d,ts_ctrl_y+e,ts_slpe_x-d,ts_slpe_y+e);a.lineTo(a_max_x-b,y+c/2);a.lineTo(bs_slpe_x-d,bs_slpe_y-e);a.bezierCurveTo(bs_ctrl_x-d,bs_ctrl_y-e,bs_ctrl_x,bs_ctrl_y,bs_slpe_x,bs_slpe_y)}});function genbank(a,b){for(var c=a.split("\n"),d=RegExp(/\s+gene\s+([a-z]*)\(?(\d+)\.\.(\d+)/),e=[],g=void 0,i=void 0,j=0;j<c.length;j++){var k;if(k=c[j].match(d)){k.shift();e.push(k);var l=k[2];if(g==void 0||g>l)g=l;k=k[1];if(i==void 0||i<k)i=k}}b.scale.max=g;b.scale.min=i;for(c=0;c<e.length;c++)d="+",e[c][0]=="complement"&&(d="-"),k=e[c][1],l=e[c][2],k=k-1+1,b.addGene(k,l-k,d)};function bed(a,b){var c=a.split("\n");numFeatures=c.length;for(var d=1;d<numFeatures;d++){if(c[d]=="")break;var e=c[d].split(" "),g=parseInt(e[1]),i=parseInt(e[2]),j=e[0]+": "+e[3],k=e[5],l=e[8],n=e[10].split(",");e=e[11].split(",");g=b.addFeature(new Complex("complex",g,i,k,[],{color:l,name:j}));for(i=0;i<n.length;i++){if(n[i]=="")break;g.addSubFeature(new BlockArrow("complex",parseInt(e[i]),parseInt(n[i]),k))}}};
